<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('学生申请')"/>
</head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>向老师提交申请</h5>
                </div>
                <div class="ibox-content">
                    <form id="applyForm" class="form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">选择老师：</label>
                            <div class="col-sm-8">
                                <select id="teacherId" name="teacherId" class="form-control" required>
                                    <option value="">== 请选择老师 ==</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">申请标题：</label>
                            <div class="col-sm-8">
                                <input type="text" name="title" class="form-control" placeholder="请输入申请标题" maxlength="100" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">申请内容：</label>
                            <div class="col-sm-8">
                                <textarea name="content" class="form-control" rows="6" placeholder="请输入申请详情" required></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-8 col-sm-offset-2">
                                <button type="submit" class="btn btn-primary">提交申请</button>
                                <button type="button" class="btn btn-white" onclick="history.back()">返回</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block th:include="include :: footer"/>
<script th:inline="javascript">
    $(function () {
        // 加载老师列表
        $.get(ctx + "ssry/teacher/tlist", function (res) {
            if (res.code === 0) {
                const select = $("#teacherId");
                res.data.forEach(teacher => {
                    select.append(`<option value="${teacher.id}">${teacher.name} (${teacher.teacherNo})</option>`);
                });
            } else {
                layer.alert("加载老师列表失败：" + res.msg, {icon: 2});
            }
        }).fail(function() {
            layer.alert("网络错误，无法加载老师列表", {icon: 2});
        });

        // 表单提交
        $("#applyForm").on("submit", function (e) {
            e.preventDefault();
            const formData = $(this).serialize();

            $.ajax({
                url: ctx + "ssry/message/studentApply",
                type: "POST",
                data: formData,
                success: function (res) {
                    if (res.code === 0) {
                        layer.msg(res.msg, {icon: 1, time: 1500}, function () {
                            window.location.href = ctx + "ssry/message/studentMessage";
                        });
                    } else {
                        layer.alert(res.msg, {icon: 2});
                    }
                },
                error: function () {
                    layer.alert("网络错误，请重试", {icon: 2});
                }
            });
        });
    });
</script>
</body>
</html>
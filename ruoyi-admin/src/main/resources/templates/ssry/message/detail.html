<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>消息详情</title>
    <th:block th:include="include :: header('消息详情')"/>
    <style>
        .detail-box {
            padding: 20px;
            background: #fff;
            border-radius: 5px;
            margin: 15px;
        }

        .detail-label {
            font-weight: bold;
            color: #333;
            width: 80px;
            display: inline-block;
        }

        .detail-content {
            margin-left: 90px;
            line-height: 1.6;
        }

        .action-buttons {
            margin-top: 10px;
        }
    </style>
</head>
<body class="gray-bg">
<div class="container-div">
    <div class="detail-box">
        <div>
            <span class="detail-label">标题：</span>
            <span class="detail-content" th:text="${message.title}">标题</span>
        </div>
        <hr/>
        <div>
            <span class="detail-label">内容：</span>
            <div class="detail-content" th:utext="${message.content}">内容</div>
        </div>
        <hr/>
        <div>
            <span class="detail-label">发送者：</span>
            <span class="detail-content">
                <span th:if="${message.senderType == 'system'}">系统</span>
                <span th:if="${message.senderType == 'teacher'}" th:text="|${#strings.defaultString(message.senderName, '教师')} (教师)|"></span>
                <span th:if="${message.senderType == 'student'}" th:text="|${#strings.defaultString(message.senderName, '学生')} (学生)|"></span>
            </span>
        </div>
        <div>
            <span class="detail-label">类型：</span>
            <span class="detail-content">
                <span th:switch="${message.msgType}">
                    <span th:case="'notice'">通知</span>
                    <span th:case="'application'">申请</span>
                    <span th:case="'reply'">回复</span>
                    <span th:case="*">未知</span>
                </span>
            </span>
        </div>
        <div>
            <span class="detail-label">时间：</span>
            <span class="detail-content" th:text="${#dates.format(message.createTime, 'yyyy-MM-dd HH:mm')}">时间</span>
        </div>

        <!-- 状态显示（仅申请） -->
        <div th:if="${message.msgType == 'application'}">
            <span class="detail-label">状态：</span>
            <span class="detail-content">
                <span th:if="${message.appStatus == 'pending'}" class="label label-warning">待审批</span>
                <span th:if="${message.appStatus == 'approved'}" class="label label-success">已批准</span>
                <span th:if="${message.appStatus == 'rejected'}" class="label label-danger">已拒绝</span>
            </span>
        </div>

        <!-- 在操作按钮区域下方添加两个 Modal -->
        <div th:if="${message.msgType == 'application' && message.appStatus == 'pending'}" class="action-buttons">
            <span class="detail-label">操作：</span>
            <span class="detail-content">
        <!-- 批准按钮触发模态框 -->
        <button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target="#approveModal">批准</button>
                <!-- 拒绝按钮触发模态框 -->
        <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#rejectModal" style="margin-left: 8px;">拒绝</button>
    </span>
        </div>

        <!-- 批准模态框 -->
        <div class="modal fade" id="approveModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">填写批准说明</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <form th:action="@{/ssry/message/approve/{id}(id=${message.id})}" method="post">
                        <div class="modal-body">
                            <div class="form-group">
                                <label>批准说明（将发送给申请人）：</label>
                                <textarea name="reason" class="form-control" rows="3" placeholder="例如：同意你的实习申请，请按时报到。" required></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                            <button type="submit" class="btn btn-success">确认批准</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 拒绝模态框 -->
        <div class="modal fade" id="rejectModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">填写拒绝理由</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <form th:action="@{/ssry/message/reject/{id}(id=${message.id})}" method="post">
                        <div class="modal-body">
                            <div class="form-group">
                                <label>拒绝理由（将发送给申请人）：</label>
                                <textarea name="reason" class="form-control" rows="3" placeholder="请说明拒绝原因..." required></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                            <button type="submit" class="btn btn-danger">确认拒绝</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block th:include="include :: footer"/>
</body>
</html>